<h1>TeamTasks</h1>

<h2>Login</h2>
<form id="loginForm">
    <input type="email" id="loginEmail" placeholder="Email" required /><br>
    <input type="password" id="loginPassword" placeholder="Password" required /><br>
    <button type="submit">Login</button>
</form>
<p id="loginError" style="color:red;"></p>

<h2>Register</h2>
<form id="registerForm">
    <input type="text" id="regName" placeholder="Name" required /><br>
    <input type="email" id="regEmail" placeholder="Email" required /><br>
    <input type="password" id="regPassword" placeholder="Password" required /><br>
    <button type="submit">Register</button>
</form>
<p id="registerError" style="color:red;"></p>

<script>
const API = "/api/users";

document.getElementById("loginForm").addEventListener("submit", async (e) => {
    e.preventDefault();
    const email = document.getElementById("loginEmail").value;
    const password = document.getElementById("loginPassword").value;
    const errorEl = document.getElementById("loginError");
    errorEl.textContent = '';

    try {
        const res = await fetch(`${API}/login`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ email, password })
        });
        if (!res.ok) throw new Error("Invalid credentials");
        const user = await res.json();
        localStorage.setItem("user_id", user.id);
        localStorage.setItem("user_name", user.name);
        window.location.href = "projects.html";
    } catch (err) {
        errorEl.textContent = err.message;
    }
});

document.getElementById("registerForm").addEventListener("submit", async (e) => {
    e.preventDefault();
    const name = document.getElementById("regName").value;
    const email = document.getElementById("regEmail").value;
    const password = document.getElementById("regPassword").value;
    const errorEl = document.getElementById("registerError");
    errorEl.textContent = '';

    try {
        const res = await fetch(`${API}/`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ name, email, password })
        });
        if (!res.ok) {
            const data = await res.json();
            throw new Error(data.detail || "Registration failed");
        }
        alert("Registration successful! You can now log in.");
        document.getElementById("registerForm").reset();
    } catch (err) {
        errorEl.textContent = err.message;
    }
});
</script>
